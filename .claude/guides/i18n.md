# Internationalization (i18n) Setup and Testing

## i18next Configuration

The project uses i18next for internationalization with support for English (en) and Dutch (nl) locales:

- **Configuration**: `src/i18n/config.ts` - language settings and locale mapping
- **Common utilities**: `src/i18n/common.ts` - shared i18n initialization logic
- **Client-side provider**: `src/i18n/client.tsx` - TranslationsProvider for client components
- **Server-side utilities**: `src/i18n/server.ts` - getI18n function for server components
- **Translation files**: `src/i18n/locales/en.json` and `src/i18n/locales/nl.json`
- **TypeScript support**: `src/types/i18next.d.ts` - type-safe translation keys

## Testing Setup - CRITICAL

**DO NOT use any I18nTestWrapper or similar test wrappers!**

The i18n testing is handled by Vitest mocks in `test/setup.tsx`:

```javascript
// Mock next-intl for client-side components
vitest.mock('next-intl', () => {
  const createMockTranslations = (namespace?: string) => {
    const baseFunction: any = assertableTranslationKeys(namespace ?? '')

    // Add the rich method to the translation function
    baseFunction.rich = vitest.fn(
      (key: string, components?: Record<string, (chunks: React.ReactNode) => React.ReactNode>) => {
        // For rich text, return the key with basic JSX handling
        if (components?.['b']) {
          const boldCallback = components['b']
          return boldCallback(baseFunction(key))
        }
        return baseFunction(key)
      }
    )

    return baseFunction
  }

  return {
    useTranslations: createMockTranslations,
    useLocale: () => 'en',
    useMessages: () => ({}),
    useNow: () => new Date(),
    useTimeZone: () => 'UTC',
    NextIntlClientProvider: ({ children }: { children: React.ReactNode }) => children,
  }
})
```

This setup:

- **Mocks useTranslations hook** to return translation keys directly (e.g., 'hero.title')
- **Supports rich text translations** with component handling
- **Enables direct testing** of translation key usage without providers
- **Uses assertableTranslationKeys** from `src/test/utils/translations.ts`
- **Includes MSW setup** for API mocking with `beforeAll`, `afterAll`, and `afterEach` hooks

## Testing Pattern

```typescript
// ✅ CORRECT - Direct component rendering
describe('MyComponent', () => {
  it('displays translated text', () => {
    render(<MyComponent />)
    expect(screen.getByText('hero.title')).toBeVisible()
  })
})

// ❌ WRONG - Never use wrappers
render(
  <I18nTestWrapper>
    <MyComponent />
  </I18nTestWrapper>
)
```

The Vitest mock handles everything - no additional setup needed in tests!
